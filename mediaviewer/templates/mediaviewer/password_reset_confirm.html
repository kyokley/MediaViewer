{% extends 'home.html' %}
<!DOCTYPE html>
{% load static %}
{% load widget_tweaks %}
{% include css %}
{% include navbar %}

{% block jumbotron %}
    <div class="jumbotron">
        <h1>MediaViewer - Reset Password</h1>
        <p></p>
    </div>
{% endblock %}

{% block main %}
    <div class="container">
        {% if validlink %}
            <div class="row">
                <div class="col-xs-4"></div>
                <div class="col-xs-4">
                    Please enter your new password and confirm it below.
                </div>
                <div class="col-xs-4"></div>
            </div>
            <div class="row">
                <div class="col-xs-4"></div>
                <div class="col-xs-4">
                    <form id="password-form" action="" method="post">
                        {% csrf_token %}
                        {% render_field form.new_password1 class+="form-control" placeholder="New password" %}
                        {% render_field form.new_password2 class+="form-control" placeholder="Confirm password" %}
                        {% if form.new_password1.errors and form.new_password2.errors and form.new_password1.errors == form.new_password2.errors %}
                            {{ form.new_password1.errors }}
                        {% else %}
                            {{ form.new_password1.errors }}
                            {{ form.new_password2.errors }}
                        {% endif %}
                        <input type="submit" value="Change password" class="btn btn-lg btn-primary btn-block login-submit-btn" />
                    </form>
                </div>
                <div class="col-xs-4"></div>
            </div>
            <div class="row">
                <div class="col-xs-2"></div>
                <div class="col-xs-8 password-description-text">
                    Valid passwords must be at least 6 characters long and contain at least one numeric character and one alphabetic character.
                </div>
            </div>
        {% else %}
            <p>This reset link is no longer valid!</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% include javascript_include %}

{% block javascript %}
    <script type="text/javascript">
        $(document).ready(function(){
            csrf_token = '{{ csrf_token }}';
            preparePage($);
            $('#password-form').submit(function(){
                var password_string = document.getElementById('id_new_password1').value;
                var is_valid = validatePassword(password_string);
                if(is_valid){
                    return true;
                }else{
                    alert("Provided password is invalid.\n\n Valid passwords must be at least 6 characters long and contain at least one numeric character and one alphabetic character. Please try again.");
                    return false;
                }
            });
        });
    </script>
{% endblock %}
