{% extends "home.html" %}
<!DOCTYPE html>
{% load staticfiles %}

{% include title %}

{% include css %}

{% include navbar %}

<!-- Main component for a primary marketing message or call to action -->
{% block jumbotron %}
    <div class="jumbotron">
        {% if view == 'files' %}
            <ol class="breadcrumb">
                <li><a href="/mediaviewer/">Home</a></li>
                <li class="active">Files</li>
            </ol>
            <h1>Files</h1>
            Below is a list of all files being tracked by the autodownloader.
        {% elif view == 'movies' %}
            <ol class="breadcrumb">
                <li><a href="/mediaviewer/">Home</a></li>
                <li class="active">Movies</li>
            </ol>
            <h1>Movies</h1>
            <h3>Select from the following movies:</h3>
        {% elif view == 'tvshows' %}
            <ol class="breadcrumb">
                <li><a href="/mediaviewer/">Home</a></li>
                <li><a href="/mediaviewer/tvshows/summary/">TV Shows</a></li>
                <li class="active">{{ path.displayName }}</li>
            </ol>
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 col-md-12">
                        <h1 class="text-center" id="file-displayName">{{ path.displayName }}</h1>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        {% if path.posterfile.image %}
                            <img src="{{ MEDIA_URL }}{{ path.posterfile.image }}" /class="img-responsive center-block"/>
                        {% else %}
                            No Image
                        {% endif %}
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <h4>
                            <dl class="dl-horizontal">
                                <dt>Summary:</dt>
                                <dd>{{ path.posterfile.plot }}</dd>
                                {% if path.posterfile.rated %}
                                    <dt>Rated:</dt>
                                    <dd>{{ path.posterfile.rated }}</dd>
                                {% endif %}
                                {% if path.posterfile.rating and path.posterfile.rating != 'N/A' %}
                                    <dt>IMDB Rating:</dt>
                                    <dd>{{ path.posterfile.rating }}/10</dd>
                                {% endif %}
                            </dl>
                        </h4>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% include messages %}

{% block main %}
    {% if files %}
        <table id="myTable" class="table display table-striped table-hover">
            <thead>
                <tr>
                    <th class="all">File Name</th>
                    <th class="desktop">Timestamp</th>
                    {% if can_download %}
                        <th class="min-tablet-p">Link</th>
                    {% endif %}
                    <th class="all">Viewed</th>
                    <th class="min-tablet-l">Report Bad File</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                    <tr>
                        {% if view == 'movies' %}
                            <td><a href="/mediaviewer/files/{{ file.id }}/">{{ file.rawSearchString }}</a></td>
                        {% else %}
                            <td><a href="/mediaviewer/files/{{ file.id }}/">{{ file.getScrapedFullName }}</a></td>
                        {% endif %}
                        <td><span class="hidden_span">{{file.dateCreatedForSpan}}</span>{{ file.datecreated.date }}</td>
                        {% if can_download %}
                            {% if waiterstatus %}
                                {% if file.finished %}
                                    <td><center><a class='btn btn-info' name='download-btn' id={{ file.id }} target=_blank rel="noopener noreferrer" onclick="openDownloadWindow('{{file.id}}')">Open</a></center></td>
                                {% else %}
                                    <td>No file</td>
                                {% endif %}
                            {% else %}
                                <td>Alfred is down</td>
                            {% endif %}
                        {% endif %}
                        <td>
                            {% if file.usercomment %}
                                {% if file.usercomment.viewed %}
                                    <span class="hidden" name="hidden-{{ file.id }}">true</span><input name="{{ file.id }}" type="checkbox" checked onclick="ajaxCheckBox('{{file.id}}')" />
                                {% else %}
                                    <span class="hidden" name="hidden-{{ file.id }}">false</span><input name="{{ file.id }}" type="checkbox" onclick="ajaxCheckBox('{{file.id}}')" />
                                {% endif %}
                            {% else %}
                                <span class="hidden" name="hidden-{{ file.id }}">false</span><input name="{{ file.id }}" type="checkbox" onclick="ajaxCheckBox('{{file.id}}')" />
                            {% endif %}
                            <span id="saved-{{ file.id }}"></span>
                        </td>
                        <td><input class='report' name='report-{{ file.id }}' value='Report' type='button' onclick="reportButtonClick('{{file.id}}')"/></td>
                        <td></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No files are available.</p>
    {% endif %}
{% endblock %}

{% include footer %}

{% include javascript_include %}

{% block javascript %}
    <script type="text/javascript">
        $(document).ready(function(){
            csrf_token = '{{ csrf_token }}';
            preparePage($);
            {% if view == 'movies' %}
                var sortOrder = [[1,1]];
            {% elif view == 'tvshows' or view == 'files' %}
                {% if default_sort == 'filename_sort' %}
                    var sortOrder =  [[0,1]];
                {% else %}
                    var sortOrder =  [[1,1]];
                {% endif %}
            {% elif view == 'datausage' or view == 'errors' %}
                var sortOrder =  [[0,1]];
            {% elif view == 'paths' %}
                var sortOrder =  [[1,0]];
            {% else %}
                var sortOrder = [[0,1]];
            {% endif %}
            prepareTableSorter($, sortOrder);

            prepareViewedCheckBoxes($);

            prepareAjaxWaiterStatus($, '{{ is_staff }}');
            scrollSetup();
        });

    </script>
{% endblock %}
