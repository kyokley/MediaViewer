{% extends "home.html" %}
<!DOCTYPE html>
{% load static %}
{% include title %}

{% include css %}

{% include navbar %}

{% block jumbotron %}
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                {% if file.isMovie %}
                    <li class="breadcrumb-item"><a href="/mediaviewer/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/mediaviewer/movies/">Movies</a></li>
                    <li class="breadcrumb-item active">{{ file.rawSearchString }}</li>
                {% else %}
                    <li class="breadcrumb-item"><a href="/mediaviewer/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/mediaviewer/tvshows/summary/">TV Shows</a></li>
                    <li class="breadcrumb-item active"><a href="/mediaviewer/tvshows/{{ file.path.id }}/">{{ file.path.displayName }}</a></li>
                {% endif %}
            </ol>
        </nav>
{% endblock %}

{% block messages %}
{% endblock %}

{% block main %}
    <form action="{% url 'mediaviewer:comment' file.id %}" method="post">
        {% csrf_token %}
        {% if error_message %}
            <p><strong>{{ error_message }}</strong></p>
        {% endif %}
            <div class="row text-center">
                <h2>
                    {{ file.displayName }}
                </h2>
            </div>
            <div class="container">
            <div class="row">
                <div class="col">
                    {% if posterfile.image %}
                        <img src="{{ MEDIA_URL }}{{ posterfile.image }}" class="large-img mx-auto d-block"/>
                    {% else %}
                        <h4>
                            No Image
                        </h4>
                    {% endif %}
                </div>
            </div>
            </div>
            <div class="row text-center justify-content-center">
                <div class="col-10">
                    <h2>
                        {% if posterfile.tagline %}
                                {{ posterfile.tagline }}
                        {% endif %}
                    </h2>
                </div>
            </div>
            {% if file.finished and can_download and waiterstatus %}
                <div class="d-grid gap-2 col-4 mx-auto">
                    <a class='btn btn-info btn-lg btn-block' name='download-btn' id={{ file.id }} target=_blank rel="noopener noreferrer" onclick="openDownloadWindow('{{file.id}}')">Open</a>
                </div>
            {% endif %}
                <h4>
                            <div class="row gy-3">
                        {% if posterfile.display_genres %}
                                <div class="col-sm-3">Genre:</div>
                                <div class="col-12 col-sm-9 truncated-text">{{ posterfile.display_genres }}</div>
                        {% endif %}
                        {% if posterfile.display_writers %}
                                <div class="col-sm-3">Writer:</div>
                                <div class="col-12 col-sm-9 truncated-text">{{ posterfile.display_writers }}</div>
                        {% endif %}
                        {% if posterfile.display_directors %}
                                <div class="col-sm-3">Director:</div>
                                <div class="col-12 col-sm-9 truncated-text">{{ posterfile.display_directors }}</div>
                        {% endif %}
                        {% if posterfile.display_actors %}
                                <div class="col-sm-3">Actors:</div>
                                <div class="col-12 col-sm-9 truncated-text">{{ posterfile.display_actors }}</div>
                        {% endif %}
                        {% if posterfile.extendedplot or posterfile.plot %}
                            <div class="col-sm-3">Description:</div>
                            {% if posterfile.extendedplot %}
                                <div class="col-12 col-sm-9 truncated-text">{{ posterfile.extendedplot }}</div>
                            {% else %}
                                <div class="col-12 col-sm-9 truncated-text">{{ posterfile.plot }}</div>
                            {% endif %}
                        {% endif %}
                        {% if posterfile.rated %}
                                <div class="col-3">Rated:</div>
                                <div class="col-9">{{ posterfile.rated }}</div>
                        {% endif %}
                        {% if posterfile.rating and posterfile.rating != 'N/A' %}
                                <div class="col-3">Rating:</div>
                                <div class="col-9">{{ posterfile.rating }}/10</div>
                        {% endif %}
                        {% if file_size and can_download %}
                                <div class="col-3">Size:</div>
                                <div class="col-9">{{ file_size }}</div>
                        {% endif %}
                        <div class="col-3">
                        <input type="hidden" name="viewed" value="" id="checkbox-input" />
                        <label for="toggle-viewed">
                            Viewed:
                        </label>
                        </div>
                        <div class="col-9">
                        {% if viewed %}
                            <span class="hidden" name="hidden-{{ file.id }}"></span><input id="toggle-viewed" name="{{ file.id }}" type="checkbox" checked onclick="ajaxCheckBox('{{file.id}}')" />
                        {% else %}
                            <span class="hidden" name="hidden-{{ file.id }}"></span><input id="toggle-viewed" name="{{ file.id }}" type="checkbox" onclick="ajaxCheckBox('{{file.id}}')" />
                        {% endif %}
                        <span id="saved-{{ file.id }}"></span>
                        </div>
                            </div>
                </h4>
            </div>
        </div>
    </form>
{% endblock %}

{% include footer %}

{% include javascript_include %}

{% block javascript %}
    <script type="text/javascript">
        $(document).ready(function(){
            csrf_token = '{{ csrf_token }}';
            preparePage($);
            setFileDetailCheckboxes('{{ viewed }}', '{{ file.hide }}');
            var input = document.getElementById('checkbox-input');
            var viewedInput = document.getElementById('toggle-viewed')
            if (viewedInput !== null){
                viewedInput.addEventListener('click', function() {
                    input.value = this.checked;
                });
            }

            var hideInput = document.getElementById('hide-checkbox-input');
            var toggleHide = document.getElementById('toggle-hide');
            if (toggleHide !== null){
                toggleHide.addEventListener('click', function() {
                    hideInput.value = this.checked;
                });
            }

            prepareAjaxWaiterStatus($, '{{ is_staff }}');
            scrollSetup();

            $(".truncated-text").shorten();
        });
    </script>
{% endblock %}
